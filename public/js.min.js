function getColor(){function e(){return Math.floor(Math.random()*t.length)}var t=["#1EAEDB","#DF8756","#34fc75","#062ca8","#a82806"];return t[e()]}var height=800,width=1200;angular.module("influences",["ui.router","ui.select","ngSanitize"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/main"),e.state("main",{url:"/main",templateUrl:"./main/views/main.html",controller:"mainCtrl",controllerAs:"main",resolve:{genreList:["genreService",function(e){return e.getMainGenres()}]}}).state("genre",{url:"/genre/:id",templateUrl:"./genre/views/genre.html",controller:"genreCtrl",controllerAs:"vw",resolve:{genre:["genreService","$stateParams",function(e,t){return e.getGenre(t.id)}],genreList:["genreService",function(e){return e.getAllGenres()}],artistList:["artistService",function(e){return e.getAllArtists()}]}}).state("genre.show",{url:"/show",templateUrl:"./genre/views/show.html"}).state("genre.edit",{url:"/edit",templateUrl:"./genre/views/edit.html"}).state("newGenre",{url:"/genre/new",templateUrl:"./newGenre/views/new.html",controller:"newGenreCtrl",controllerAs:"vw",resolve:{genreList:["genreService",function(e){return e.getAllGenres()}],artistList:["artistService",function(e){return e.getAllArtists()}]}}).state("artist",{url:"/artist/:id",templateUrl:"./artist/views/artist.html",controller:"artistCtrl",controllerAs:"vw",resolve:{artist:["artistService","$stateParams",function(e,t){return e.getArtist(t.id)}],allArtists:["artistService",function(e){return e.getAllArtists()}],allGenres:["genreService",function(e){return e.getAllGenres()}]}}).state("artist.show",{templateUrl:"./artist/views/show.html"}).state("artist.edit",{url:"/edit",templateUrl:"./artist/views/edit-artist.html"}).state("newArtist",{url:"/artist/new",templateUrl:"./newArtist/views/artist.html",controller:"newArtistCtrl",controllerAs:"vw",resolve:{allArtists:["artistService",function(e){return e.getAllArtists()}],allGenres:["genreService",function(e){return e.getAllGenres()}]}}).state("profile",{url:"/user/profile",templateUrl:"./user/views/profile.html",controller:"userProfileCtrl",controllerAs:"vw"}).state("admin",{url:"/admin/",templateUrl:"./admin/views/admin.html",controller:"adminCtrl",controllerAs:"vw",resolve:{artistsList:["artistService",function(e){return e.getAllArtists()}],genresList:["genreService",function(e){return e.getAllGenres()}]}}).state("admin.artist",{templateUrl:"./admin/views/artist.html"}).state("admin.genres",{templateUrl:"./admin/views/genres.html"}).state("admin.users",{templateUrl:"./admin/views/users.html"})}]).filter("propsFilter",function(){return function(e,t){var r=[];return angular.isArray(e)?e.forEach(function(e){for(var n=!1,i=Object.keys(t),l=0;l<i.length;l++){var s=i[l],a=t[s].toLowerCase();if(e[s]&&-1!==e[s].toString().toLowerCase().indexOf(a)){n=!0;break}}n&&r.push(e)}):r=e,r}});
angular.module("influences").controller("indexCtrl",["$scope","userService",function(t,e){e.getCurrentUser().then(function(t){t&&(this.currentUser=t)}.bind(this)),this.active={},t.$on("activateModal",function(t,e){this.active={},this.active.modal=!0,this.active[e]=!0}.bind(this)),t.$on("modal action complete",function(t,i){var n=this;n.active={},e.getCurrentUser(function(t){n.currentUser=t})}.bind(this))}]);
angular.module("influences").controller("adminCtrl",["$scope","artistsList","genresList","artistService","genreService","$state","userService",function(t,e,i,n,s,r,o){this.artistsList=e,this.genresList=i,this.deleteArtist=function(t){var e=this;n.deleteArtist(t).then(function(t){n.getAllArtists().then(function(t){e.artistsList=t})})}.bind(this),this.generateInviteToken=function(){var t=this;o.getInviteToken().then(function(e){t.inviteToken=e.inviteToken})}.bind(this)}]);
angular.module("influences").controller("artistCtrl",["$scope","artist","artistService","$state","allArtists","allGenres",function(t,s,i,r,e,a){r.go("artist.show"),this.artist=s,this.artistList=e,this.genreList=a,this.groupArtists=function(t){return t.fullName>="A"&&t.fullName<="M"?"From A - M":t.fullName>="N"&&t.fullName<="Z"?"From N - Z":void 0},this.updateArtist=function(t){i.updateArtist(t).then(function(t){r.go("artist.show",{},{reload:!0})})}}]);
angular.module("influences").controller("genreCtrl",["$scope","artistList","genre","genreList","genreService","$state",function(e,t,n,r,i,s){this.genre=n,this.genreList=r,this.artistList=t,this.updateGenre=function(e){i.updateGenre(e).then(function(e){s.go("genre.show",{},{reload:!0})})}}]);
angular.module("influences").controller("newArtistCtrl",["$scope","artistService","$state","allArtists","allGenres",function(t,i,e,s,r){this.createArtist=function(t){i.createArtist(t).then(function(t){console.log("Res is",t,"in artistService"),e.go("artist",{id:t.id})})},this.genreList=r,this.artistList=s}]);
angular.module("influences").controller("newGenreCtrl",["$scope","artistList","genreList","genreService","$state",function(e,t,n,i,r){this.artistList=t,this.genreList=n,this.createGenre=function(e){i.createGenre(e).then(function(e){r.go("genre.show",{id:e.id})})}}]);
angular.module("influences").controller("userProfileCtrl",["$scope","userService",function(e,r){r.getCurrentUser().then(function(e){this.user=e,console.log("user profile",this.user)}.bind(this)),this.updateUser=function(e){r.updateUser(e)}}]);
angular.module("influences").controller("mainCtrl",["genreList",function(n){this.genreList=n,console.log("In main ctrl, this genrelist",this.genreList)}]);
angular.module("influences").directive("artistHeader",function(){return{restrict:"A",scope:{image:"="},link:function(e,i,a){i.append("<img src="+e.image.url+">"),i.append('<div class="black"></div>'),i.append('<div class="red"></div>'),i.append('<div class="blue"></div>')}}});
angular.module("influences").directive("dropdownMenu",function(){return{restrict:"AE",templateUrl:"./directives/views/dropdownMenu.html",scope:{currentUser:"="},controller:["$scope","userService","$state",function(e,n,o){e.activateModal=function(n){e.$emit("activateModal",n),e.menuActive=!1},e.logoutUser=function(){n.logoutUser().then(function(){e.menuActive=!1,o.go("main",{},{reload:!0})})},e.$on("close menu",function(){e.menuActive=!1})}],link:function(e,n,o){var t=n.find("div.menuButtonContainer");t.on("mouseenter",function(){console.log("Mouse enter"),t.toggleClass("menuButtonContainerHover")}),t.on("mouseleave",function(){t.toggleClass("menuButtonContainerHover")})}}});
angular.module("influences").directive("forceChart",["$compile","$state",function(t,r){return{restrict:"AE",template:"<svg height="+height+" width="+width+"></svg>",scope:{root:"="},controller:["$scope","$window",function(t,r){t.window=r}],link:function(t,e,n){function o(){t.root.founders&&(t.root.proteges=t.root.founders),f.push({name:t.root.fullName||t.root.name,x:s.x,y:s.y,fixed:!0,root:!0,type:t.root.type,id:t.root.id}),t.root.proteges&&t.root.proteges.forEach(function(t){var r={name:t.fullName,x:s.x,y:s.y,id:t.id,type:t.type};f.push(r),l.push({source:r,target:f[0]}),t.proteges&&i(t,r)}),c()}function i(t,r){var e;t.proteges.forEach(function(t){e={name:t.fullName,x:s.x,y:s.y,proteges:t.proteges,id:t.id,type:t.type},t.proteges&&i(t,e),f.push(e),l.push({source:e,target:r,d:width/50,proteges:t.proteges})})}function c(){var t=a.layout.force().size([width,height]).nodes(f).links(l).linkDistance(function(t){return t.d?t.d:width/20}).linkStrength(1).gravity(.2).friction(.7).charge(-3e3);t.start();var e=u.selectAll("lines").data(l).enter().append("line").attr("class","link").attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),n=u.selectAll("nodes").data(f).enter().append("circle").attr("class","node").attr("r",width/80).attr("cx",function(t){return s.x}).attr("cy",function(t){return s.y}).on("click",function(t){r.go(t.type+".show",{id:t.id})}),o=u.selectAll("text").data(f).enter().append("foreignObject").attr("class","artist").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).on("click",function(t){r.go(t.type+".show",{id:t.id})}).html(function(t){return'<span class="artist first">'+t.name[0]+"</span> "+t.name.slice(1)});t.on("tick",function(){n.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),e.attr("x1",function(t){return t.source.x}).attr("x2",function(t){return t.target.x}).attr("y1",function(t){return t.source.y}).attr("y2",function(t){return t.target.y}),o.attr("x",function(t){return t.x}).attr("y",function(t){return t.y})})}var a=t.window.d3,u=a.select(e.find("svg")[0]),s={x:width/3,y:height/3},f=[],l=[];t.$watch("root",function(){o()})}}}]);
angular.module("influences").directive("forceMain",["chartService","$state",function(t,n){function r(r,e,i){var c=r.window.d3,o=c.select(e.find("svg")[0]),a=[],u=[];r.root.forEach(function(n){var r=t.format(n,"subgenres");r.nodes.forEach(function(t){a.push(t)}),r.links.forEach(function(t){u.push(t)})});var s=c.layout.force().size([width,height]).nodes(a).links(u).linkDistance(width/20).linkStrength(1).gravity(.4).friction(.7).charge(-3e3);s.start();var f=o.selectAll("lines").data(u).enter().append("line").attr("class","link").attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),l=o.selectAll("nodes").data(a).enter().append("circle").attr("class","node").style("fill",function(t){return t.color}).attr("r",function(t){return t.r||width/80}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).on("click",function(t){n.go(t.type+".show",{id:t.id})}),d=o.selectAll("text").data(a).enter().append("foreignObject").attr("class","artist").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).on("click",function(t){n.go(t.type+".show",{id:t.id})}).html(function(t){return'<span class="artist first">'+t.text[0]+"</span> "+t.text.slice(1)});s.on("tick",function(){l.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),f.attr("x1",function(t){return t.source.x}).attr("x2",function(t){return t.target.x}).attr("y1",function(t){return t.source.y}).attr("y2",function(t){return t.target.y}),d.attr("x",function(t){return t.x}).attr("y",function(t){return t.y})})}return{restrict:"E",template:"<div class='force-main'><svg id='chart' height="+height+" width="+width+"></svg></div>",scope:{root:"="},controller:["$scope","$window",function(t,n){t.window=n}],link:r}}]);
angular.module("influences").directive("loginModal",function(){return{restrict:"AE",scope:{},templateUrl:"./directives/views/loginModal.html",controller:["$scope","userService","$state",function(e,n,o){e.loginUser=function(i){n.loginUser({username:i.username,password:i.password}).then(function(n){o.go("genre",{id:2}),e.$emit("modal action complete")})}}]}});
angular.module("influences").directive("menuItem",function(){return{restrict:"A",scope:{},link:function(e,n,o){n.on("mouseenter",function(){n.toggleClass("menu-item-hover")}),n.on("mouseleave",function(){n.toggleClass("menu-item-hover")}),n.on("click",function(){e.$emit("close menu")})}}});
angular.module("influences").directive("searchBar",["artistService","genreService","$q",function(e,r,t){return{restrict:"AE",templateUrl:"./directives/views/searchBar.html",scope:!0,controllerAs:"vw",controller:["$scope","artistService","genreService","searchService","$state",function(e,r,t,i,c){var n=this;n.refreshItems=function(e){i.searchForName(e).then(function(e){n.items=e})},n.goTo=function(e){c.go(e.type,{id:e.id})},n.test="hello!"}]}}]);
angular.module("influences").directive("signupModal",function(){return{restrict:"AE",scope:!0,templateUrl:"./directives/views/signupModal.html",controller:["$scope","userService","$state",function(e,n,i){e.signupUser=function(e){n.signupUser(e).then(function(e){i.go("main",{},{reload:!0})})}}]}});
angular.module("influences").service("artistService",["$http","spotifyService",function(t,r){this.getArtist=function(e){var i;return t({method:"GET",url:"/api/artist/"+e}).then(function(t){return i=t.data,r.getArtistImage(i.fullName)}).then(function(t){return i.image=t,i})},this.updateArtist=function(r){return t({method:"PUT",url:"/api/artist/"+r.id,data:r}).then(function(t){return t.data})},this.getAllArtists=function(){return t({method:"GET",url:"/api/artist/"}).then(function(t){return t.data})},this.createArtist=function(r){return t({method:"POST",data:r,url:"/api/artist/"}).then(function(t){return console.log("Artist in artistService",t),t.data})},this.deleteArtist=function(r){return t({method:"DELETE",url:"/api/artist/"+r.id}).then(function(t){return t.data})}}]);
angular.module("influences").service("chartService",["$http","$state",function(t,e){this.format=function(t,e){function r(t,e){var i;t.forEach(function(t){i={name:t.fullName||t.name,next:t.subgenres||t.proteges,id:t.id,type:t.type,text:t.name,color:getColor()},t.next&&r(t,i),n.push(i),o.push({source:i,target:e})})}var n=[],o=[];n.push({text:t.name||t.fullName,root:!0,type:t.type,id:t.id,color:getColor(),r:t.subgenre?void 0:width/50});var i=e?t[e]:t.founders;return i&&i.forEach(function(t){var e={text:t.name||t.fullName,id:t.id,type:t.type,color:getColor()};n.push(e),o.push({source:e,target:n[0]});var i=t.proteges||t.subgenres;i&&r(i,e)}),{nodes:n,links:o}},this.initForce=function(t,r){t=t||[],r=r||[];var n=d3.layout.force().size([width,height]).nodes(t).links(r).linkDistance(width/20).linkStrength(1).gravity(.2).friction(.7).charge(-3e3),o=this.selectAll("lines").data(r).enter().append("line").attr("class","link").attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),i=this.selectAll("nodes").data(t).enter().append("circle").attr("class","node").attr("r",width/100).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).on("click",function(t){e.go(t.type+".show",{id:t.id})});return{force:n,links:o,nodes:i}},this.updateTick=function(t,e){t.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),e.attr("x1",function(t){return t.source.x}).attr("x2",function(t){return t.target.x}).attr("y1",function(t){return t.source.y}).attr("y2",function(t){return t.target.y})}}]);
angular.module("influences").service("genreService",["$http","$state",function(e,n){this.getMainGenres=function(){return e({method:"GET",url:"/api/main/genres"}).then(function(e){return e.data})},this.getRandomGenre=function(){return e({method:"GET",url:"/api/genre/random"}).success(function(e){n.go("genre",{id:e.id})})},this.createGenre=function(n){return e({method:"POST",url:"/api/genre",data:n}).then(function(e){return e.data})},this.getAllGenres=function(){return e({method:"GET",url:"/api/genre/"}).then(function(e){return e.data})},this.getGenre=function(n){return e({method:"GET",url:"/api/genre/"+n}).then(function(e){return e.data})},this.updateGenre=function(n){return n={name:n.name,type:n.type,founders:n.founders,artists:n.artists,id:n.id,description:n.description},e({method:"PUT",url:"/api/genre/"+n.id,data:n}).then(function(e){return e.data})}}]);
angular.module("influences").service("searchService",["$http",function(e){this.searchForName=function(r){return e({method:"GET",url:"/api/search/?query="+r}).then(function(e){return e.data})}}]);
angular.module("influences").service("spotifyService",["$http",function(t){var i={url:"https://api.spotify.com/v1/search?q=",tag:"&type=artist&limit=1"};this.getArtistImage=function(e){return e=e.split(" ").join("+"),t({method:"GET",url:i.url+e+i.tag}).then(function(t){return console.log(t.data),t.data.artists.items[0].images[0]})}}]);
angular.module("influences").service("userService",["$http",function(n){this.getCurrentUser=function(t){return n.get("/api/users/current").then(function(n){return t?t(n.data):n.data})},this.loginUser=function(t){return n({method:"POST",data:t,url:"/login"}).then(function(n){return n.data})},this.signupUser=function(t){return n({method:"POST",data:t,url:"/signup"}).then(function(n){return n.data})},this.updateUser=function(t){return n({method:"PUT",data:t,url:"/api/users/"+t.id}).success(function(n){return n}).error(function(n){console.log(n)})},this.logoutUser=function(){return n({method:"POST",url:"/logout"}).then(function(n){return n}).error(function(n){console.log(n)})},this.getInviteToken=function(){return console.log("in User service"),n({method:"POST",url:"/api/users/token"}).then(function(n){return console.log(n),n.data})}}]);